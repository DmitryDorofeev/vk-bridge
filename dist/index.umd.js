!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e=e||self).vkBridge={})}(this,function(e){"use strict";var a=function(){return(a=Object.assign||function(e){for(var n,t=1,o=arguments.length;t<o;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e}).apply(this,arguments)};function u(){for(var e=0,n=0,t=arguments.length;n<t;n++)e+=arguments[n].length;for(var o=Array(e),r=0,n=0;n<t;n++)for(var i=arguments[n],p=0,a=i.length;p<a;p++,r++)o[r]=i[p];return o}function o(i,e){var o,r,p=(o={current:0,next:function(){return++this.current}},r={},{add:function(e,n){var t=null!=n?n:o.next();return r[t]=e,t},resolve:function(e,n,t){var o=r[e];o&&(t(n)?o.resolve(n):o.reject(n),r[e]=null)}});return e(function(e){var n,t,o;e.detail&&e.detail.data&&"request_id"in e.detail.data&&(t=(n=e.detail.data).request_id,o=function(e,n){var t={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&n.indexOf(o)<0&&(t[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,o=Object.getOwnPropertySymbols(e);r<o.length;r++)n.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(t[o[r]]=e[o[r]]);return t}(n,["request_id"]),t&&p.resolve(t,o,function(e){return!("error_type"in e)}))}),function(o,r){return void 0===r&&(r={}),new Promise(function(e,n){var t=p.add({resolve:e,reject:n},r.request_id);i(o,a(a({},r),{request_id:t}))})}}var n="undefined"!=typeof window,d=Boolean(n&&window.AndroidBridge),s=Boolean(n&&window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.VKWebAppClose),c=n&&!d&&!s,t=c&&/(^\?|&)vk_platform=mobile_web(&|$)/.test(location.search),r=c?"message":"VKWebAppEvent",f=u(["VKWebAppInit","VKWebAppGetCommunityAuthToken","VKWebAppAddToCommunity","VKWebAppGetUserInfo","VKWebAppSetLocation","VKWebAppGetClientVersion","VKWebAppGetPhoneNumber","VKWebAppGetEmail","VKWebAppGetGeodata","VKWebAppSetTitle","VKWebAppGetAuthToken","VKWebAppCallAPIMethod","VKWebAppJoinGroup","VKWebAppLeaveGroup","VKWebAppAllowMessagesFromGroup","VKWebAppDenyNotifications","VKWebAppAllowNotifications","VKWebAppOpenPayForm","VKWebAppOpenApp","VKWebAppShare","VKWebAppShowWallPostBox","VKWebAppScroll","VKWebAppShowOrderBox","VKWebAppShowLeaderBoardBox","VKWebAppShowInviteBox","VKWebAppShowRequestBox","VKWebAppAddToFavorites","VKWebAppShowCommunityWidgetPreviewBox","VKWebAppShowStoryBox","VKWebAppStorageGet","VKWebAppStorageGetKeys","VKWebAppStorageSet"],c&&!t?["VKWebAppResizeWindow","VKWebAppAddToMenu"]:[]),l=n?window.ReactNativeWebView:void 0,b=n?window.AndroidBridge:void 0,v=s?window.webkit.messageHandlers:void 0;function i(){for(var o=[],e=0;e<arguments.length;e++)o[e]=arguments[e];return o.includes(void 0)||o.includes(null)?i.apply(void 0,o.filter(function(e){return"function"==typeof e})):function(t){if(0===o.length)return t;var n={subscribe:t.subscribe,send:function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.send.apply(t,e)}},e=o.filter(function(e){return"function"==typeof e}).map(function(e){return e(n)}).reduce(function(n,t){return function(e){return n(t(e))}})(t.send);return a(a({},t),{send:e})}}function p(e,n){var t=n||{bubbles:!1,cancelable:!1,detail:void 0},o=document.createEvent("CustomEvent");return o.initCustomEvent(e,!!t.bubbles,!!t.cancelable,t.detail),o}"undefined"==typeof window||window.CustomEvent||(window.CustomEvent=(p.prototype=Event.prototype,p));var w=function(t){var i=void 0,p=[];function e(e){p.push(e)}"undefined"!=typeof window&&"addEventListener"in window&&window.addEventListener(r,function(n){return s||d?u(p).map(function(e){return e.call(null,n)}):void((c||l)&&n&&n.data&&(e=n.data,t=e.type,o=e.data,r=e.frameId,t&&"VKWebAppSettings"===t?i=r:u(p).map(function(e){return e({detail:{type:t,data:o}})})));var e,t,o,r});var n=o(function(e,n){b&&b[e]?b[e](JSON.stringify(n)):v&&v[e]&&"function"==typeof v[e].postMessage?v[e].postMessage(n):l?l.postMessage(JSON.stringify({handler:e,params:n,type:"vk-connect",webFrameId:i,connectVersion:t})):c&&parent.postMessage({handler:e,params:n,type:"vk-connect",webFrameId:i,connectVersion:t},"*")},e);return{send:n,sendPromise:n,subscribe:e,unsubscribe:function(e){var n=p.indexOf(e);-1<n&&p.splice(n,1)},supports:function(e){return d?!(!b||"function"!=typeof b[e]):s?!(!v||!v[e]||"function"!=typeof v[e].postMessage):!(!c&&!l)&&-1<f.indexOf(e)},isWebView:function(){return s||d}}}("2.2.2");e.applyMiddleware=i,e.default=w,Object.defineProperty(e,"__esModule",{value:!0})});
